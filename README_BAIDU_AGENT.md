# Mario AI åŠ©æ‰‹ - ç™¾åº¦æ™ºèƒ½ä½“é›†æˆç‰ˆ

æœ¬é¡¹ç›®åŸºäºç«‹åˆ›å®æˆ˜æ´¾ ESP32-S3 å¼€å‘æ¿,é›†æˆäº†ç™¾åº¦æ™ºèƒ½ä½“ Conversation API,å®ç°äº†ä¸€ä¸ªå¸¦ LVGL å›¾å½¢ç•Œé¢çš„ AI è¯­éŸ³åŠ©æ‰‹ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… **LVGL å›¾å½¢ç•Œé¢** - ä½¿ç”¨ ST7789 æ˜¾ç¤ºå±æ˜¾ç¤º UI
- âœ… **WiFi è¿æ¥ç®¡ç†** - è‡ªåŠ¨è¿æ¥å’Œé‡è¿æœºåˆ¶
- âœ… **ç™¾åº¦æ™ºèƒ½ä½“é›†æˆ** - åŸºäº SSE åè®®çš„å®æ—¶å¯¹è¯
- âœ… **ä¸­æ–‡å­—ä½“æ”¯æŒ** - ä» SPIFFS åŠ è½½ NotoSans ä¸­æ–‡å­—ä½“
- âœ… **å®æ—¶çŠ¶æ€æ˜¾ç¤º** - UI å®æ—¶æ˜¾ç¤ºè¿æ¥çŠ¶æ€å’Œå¯¹è¯å†…å®¹

## ğŸ“ é¡¹ç›®ç»“æ„

```
vv-esp/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ hello_world_main.c      # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ baidu_agent_client.h    # ç™¾åº¦æ™ºèƒ½ä½“å®¢æˆ·ç«¯å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ baidu_agent_client.c    # ç™¾åº¦æ™ºèƒ½ä½“å®¢æˆ·ç«¯å®ç° (SSE åè®®)
â”‚   â”œâ”€â”€ wifi_manager.h          # WiFi ç®¡ç†æ¨¡å—å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ wifi_manager.c          # WiFi ç®¡ç†æ¨¡å—å®ç°
â”‚   â”œâ”€â”€ font_loader.h           # å­—ä½“åŠ è½½å™¨
â”‚   â”œâ”€â”€ font_loader.c           # å­—ä½“åŠ è½½å™¨å®ç°
â”‚   â””â”€â”€ CMakeLists.txt          # ç»„ä»¶æ„å»ºé…ç½®
â”œâ”€â”€ assets/                     # å­—ä½“èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ font_notosans_14.bin
â”‚   â”œâ”€â”€ font_notosans_32.bin
â”‚   â””â”€â”€ index.json
â”œâ”€â”€ CMakeLists.txt              # é¡¹ç›®æ„å»ºé…ç½®
â”œâ”€â”€ Kconfig.projbuild           # WiFi é…ç½®é€‰é¡¹
â””â”€â”€ README_BAIDU_AGENT.md       # æœ¬æ–‡æ¡£
```

## ğŸ”§ ç¡¬ä»¶è¦æ±‚

- ç«‹åˆ›å®æˆ˜æ´¾ ESP32-S3 å¼€å‘æ¿
- ST7789 æ˜¾ç¤ºå± (320x240)
- WiFi ç½‘ç»œè¿æ¥

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒè®¾ç½®

### 1. å®‰è£… ESP-IDF

ç¡®ä¿å·²å®‰è£… ESP-IDF v5.0 æˆ–æ›´é«˜ç‰ˆæœ¬:

```bash
# å…‹éš† ESP-IDF (å¦‚æœè¿˜æ²¡æœ‰)
git clone --recursive https://github.com/espressif/esp-idf.git
cd esp-idf
./install.sh

# è®¾ç½®ç¯å¢ƒå˜é‡
. ./export.sh
```

### 2. é…ç½®é¡¹ç›®

```bash
cd vv-esp

# é…ç½® WiFi SSID å’Œå¯†ç 
idf.py menuconfig
```

åœ¨èœå•ä¸­å¯¼èˆªåˆ°:
- `Mario AI WiFi Configuration`
  - `WiFi SSID` - è¾“å…¥ä½ çš„ WiFi åç§°
  - `WiFi Password` - è¾“å…¥ä½ çš„ WiFi å¯†ç 

ä¿å­˜å¹¶é€€å‡º (æŒ‰ S, ç„¶å Q)ã€‚

### 3. ç¼–è¯‘é¡¹ç›®

```bash
idf.py build
```

### 4. çƒ§å½•åˆ°å¼€å‘æ¿

```bash
# è¿æ¥å¼€å‘æ¿,ç„¶åçƒ§å½•
idf.py -p /dev/ttyUSB0 flash

# æŸ¥çœ‹ä¸²å£è¾“å‡º
idf.py -p /dev/ttyUSB0 monitor
```

## ğŸ“± ä½¿ç”¨è¯´æ˜

### å¯åŠ¨æµç¨‹

1. å¼€å‘æ¿ä¸Šç”µå,ä¼šä¾æ¬¡åˆå§‹åŒ–:
   - SPIFFS æ–‡ä»¶ç³»ç»Ÿ
   - I2C æ€»çº¿å’Œ PCA9557 IO æ‰©å±•èŠ¯ç‰‡
   - èƒŒå…‰æ§åˆ¶
   - SPI æ€»çº¿
   - ST7789 LCD æ˜¾ç¤ºå±
   - LVGL å›¾å½¢åº“
   - åŠ è½½ä¸­æ–‡å­—ä½“
   - åˆ›å»º UI ç•Œé¢
   - è¿æ¥ WiFi
   - åˆå§‹åŒ–ç™¾åº¦æ™ºèƒ½ä½“å®¢æˆ·ç«¯

2. WiFi è¿æ¥æˆåŠŸå,ä¼šè‡ªåŠ¨å‘é€æµ‹è¯•æ¶ˆæ¯ "ä½ å¥½,æˆ‘æ˜¯Mario!"

3. å±å¹•ä¼šæ˜¾ç¤ºç™¾åº¦æ™ºèƒ½ä½“çš„å›å¤å†…å®¹

### UI ç•Œé¢è¯´æ˜

- **ä¸»æ ‡é¢˜**: "æˆ‘æ˜¯Mario" (32px å­—ä½“)
- **å‰¯æ ‡é¢˜**: "ç™¾åº¦æ™ºèƒ½ä½“ç‰ˆ" (14px å­—ä½“)
- **å“åº”å†…å®¹**: æ˜¾ç¤ºæ™ºèƒ½ä½“çš„å›å¤ (è‡ªåŠ¨æ¢è¡Œ)
- **çŠ¶æ€æ **: åº•éƒ¨æ˜¾ç¤ºå½“å‰è¿æ¥çŠ¶æ€ (é‡‘è‰²æ–‡å­—)

## ğŸ”Œ API é›†æˆè¯´æ˜

### ç™¾åº¦æ™ºèƒ½ä½“ API

- **API åœ°å€**: `https://agents.baidu.com/api/conversation`
- **åè®®**: SSE (Server-Sent Events)
- **è®¤è¯**: ä½¿ç”¨ App ID å’Œ Secret Key
- **è¯·æ±‚æ–¹å¼**: GET
- **URL å‚æ•°**:
  - `appId` - åº”ç”¨ ID
  - `secretKey` - å¯†é’¥
  - `query` - æŸ¥è¯¢å†…å®¹ (URL ç¼–ç )
  - `stream` - è®¾ç½®ä¸º `true` å¯ç”¨æµå¼å“åº”

### ä¿®æ”¹ API å‡­è¯

åœ¨ [`hello_world_main.c`](main/hello_world_main.c:432) çš„ `init_baidu_agent()` å‡½æ•°ä¸­ä¿®æ”¹:

```c
baidu_agent_config_t config = {
  .app_id = "ä½ çš„_APP_ID",
  .secret_key = "ä½ çš„_SECRET_KEY",
  .callback = agent_event_callback,
  .user_data = NULL,
  .auto_reconnect = true,
  .reconnect_interval = 5000,
};
```

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

ç¼–è¯‘æ—¶å¯ç”¨è¯¦ç»†æ—¥å¿—:

```bash
idf.py menuconfig
# Component config -> Log output -> Default log verbosity -> Verbose
```

### å¸¸è§é—®é¢˜

1. **WiFi è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ SSID å’Œå¯†ç æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤è·¯ç”±å™¨ä½¿ç”¨ WPA2 åŠ å¯†
   - æŸ¥çœ‹ä¸²å£è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯

2. **æ˜¾ç¤ºå±æ— å†…å®¹**
   - æ£€æŸ¥èƒŒå…‰æ˜¯å¦å¼€å¯
   - ç¡®è®¤ SPI å¼•è„šè¿æ¥æ­£ç¡®
   - æŸ¥çœ‹æ—¥å¿—ä¸­ LCD åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ

3. **å­—ä½“åŠ è½½å¤±è´¥**
   - ç¡®è®¤ SPIFFS åˆ†åŒºå·²æ­£ç¡®åˆ›å»º
   - æ£€æŸ¥ `assets/` ç›®å½•ä¸­æ˜¯å¦æœ‰å­—ä½“æ–‡ä»¶
   - æŸ¥çœ‹æ—¥å¿—ä¸­ SPIFFS æŒ‚è½½çŠ¶æ€

4. **HTTP è¿æ¥é”™è¯¯**
   - ç¡®è®¤å¼€å‘æ¿å·²è¿æ¥åˆ°äº’è”ç½‘
   - æ£€æŸ¥ API å‡­è¯æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹ HTTP å®¢æˆ·ç«¯çš„é”™è¯¯æ—¥å¿—

## ğŸ“ ä»£ç ç»“æ„è¯´æ˜

### ä¸»è¦æ¨¡å—

1. **WiFi ç®¡ç†æ¨¡å—** ([`wifi_manager.c`](main/wifi_manager.c))
   - è‡ªåŠ¨è¿æ¥å’Œé‡è¿
   - çŠ¶æ€å›è°ƒé€šçŸ¥
   - IP åœ°å€è·å–

2. **ç™¾åº¦æ™ºèƒ½ä½“å®¢æˆ·ç«¯** ([`baidu_agent_client.c`](main/baidu_agent_client.c))
   - SSE åè®®è§£æ
   - HTTP è¿æ¥ç®¡ç†
   - äº‹ä»¶å›è°ƒæœºåˆ¶

3. **å­—ä½“åŠ è½½å™¨** ([`font_loader.c`](main/font_loader.c))
   - ä» SPIFFS åŠ è½½äºŒè¿›åˆ¶å­—ä½“æ–‡ä»¶
   - æ”¯æŒå¤šç§å­—ä½“å¤§å°

### å›è°ƒæœºåˆ¶

- **WiFi çŠ¶æ€å›è°ƒ**: åœ¨ WiFi è¿æ¥/æ–­å¼€æ—¶æ›´æ–° UI çŠ¶æ€
- **æ™ºèƒ½ä½“äº‹ä»¶å›è°ƒ**: æ¥æ”¶æ™ºèƒ½ä½“çš„æ¶ˆæ¯å¹¶æ›´æ–° UI

## ğŸš€ æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ›´å¤šå¯¹è¯åŠŸèƒ½

ä¿®æ”¹ [`hello_world_main.c`](main/hello_world_main.c) ä¸­çš„ä¸»å¾ªç¯,æ·»åŠ å®šæ—¶å‘é€æ¶ˆæ¯:

```c
// ä¸»å¾ªç¯
int counter = 0;
while (1) {
  vTaskDelay(pdMS_TO_TICKS(1000));
  
  // æ¯ 30 ç§’å‘é€ä¸€æ¬¡æ¶ˆæ¯
  if (++counter >= 30) {
    baidu_agent_send_message(agent_handle, "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·?", 0);
    counter = 0;
  }
}
```

### æ·»åŠ æŒ‰é”®è¾“å…¥

å¯ä»¥é›†æˆæŒ‰é”®æ£€æµ‹,æ ¹æ®æŒ‰é”®è§¦å‘ä¸åŒçš„å¯¹è¯:

```c
// ç¤ºä¾‹: æŒ‰é”®è§¦å‘å¯¹è¯
if (button_pressed) {
  baidu_agent_send_message(agent_handle, "è®²ä¸ªç¬‘è¯", 0);
}
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº ESP-IDF å’Œ LVGL å¼€æºé¡¹ç›®æ„å»ºã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜,è¯·åœ¨ GitHub ä¸Šæäº¤ Issueã€‚

---

**äº«å—ä½ çš„ Mario AI åŠ©æ‰‹! ğŸ®**